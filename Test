# --- Configuration ---
$DispatcherURL = "https://na206.epm.cyberark.com"
$AccountName   = "YOUR_ACCOUNT_NAME" # As seen in your EPM URL
$UserName      = "YOUR_EPM_USERNAME"
$Password      = "YOUR_PASSWORD"

# --- Authentication ---
$authUrl = "$DispatcherURL/EPM/API/Auth/EPM/Logon"
$headers = @{
    "EPM-Account"  = $AccountName
    "Content-Type" = "application/json"
}
$body = @{
    "Username"      = $UserName
    "Password"      = $Password
    "ApplicationId" = "EPM_API_Test"
} | ConvertTo-Json

try {
    Write-Host "Attempting to authenticate with $authUrl..." -ForegroundColor Cyan
    $response = Invoke-RestMethod -Method Post -Uri $authUrl -Headers $headers -Body $body
    
    # The response for a successful EPM login is a raw string (the token)
    $sessionToken = $response
    Write-Host "Success! Session Token received." -ForegroundColor Green
    Write-Host "Token: $sessionToken" -ForegroundColor Gray
}
catch {
    Write-Host "Error occurred:" -ForegroundColor Red
    $_.Exception.Message
    $_.ErrorDetails.Message | ConvertTo-Json
}
